<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego con Firebase</title>
<style>
body { font-family: Arial; background:#111; color:white; }
input, button { margin:5px; padding:6px; }
.online { color:lime; }
.offline { color:red; }
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot } 
from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

let currentUser = null;

// REGISTRO
window.register = async () => {
  const email = emailInput.value;
  const pass = passInput.value;
  const name = nameInput.value;

  const cred = await createUserWithEmailAndPassword(auth, email, pass);
  await setDoc(doc(db, "users", cred.user.uid), {
    name,
    online: true,
    friends: []
  });
};

// LOGIN
window.login = async () => {
  await signInWithEmailAndPassword(auth, emailInput.value, passInput.value);
};

// ESTADO LOGIN
onAuthStateChanged(auth, async (user) => {
  if (!user) return;
  currentUser = user;
  authBox.style.display = "none";
  gameBox.style.display = "block";

  await updateDoc(doc(db,"users",user.uid), { online:true });
  loadFriends();
});

// AÃ‘ADIR AMIGO
window.addFriend = async () => {
  const friendName = friendInput.value;
  const snap = await getDoc(doc(db,"users",currentUser.uid));
  const data = snap.data();

  data.friends.push(friendName);
  await updateDoc(doc(db,"users",currentUser.uid), { friends:data.friends });
};

// CARGAR AMIGOS
async function loadFriends(){
  const snap = await getDoc(doc(db,"users",currentUser.uid));
  const data = snap.data();
  friends.innerHTML = "";

  data.friends.forEach(f=>{
    const li = document.createElement("li");
    li.textContent = f + " ðŸ”´";
    friends.appendChild(li);
  });
}
</script>
</head>

<body>

<div id="authBox">
  <h2>Registro / Login</h2>
  <input id="nameInput" placeholder="Nombre"><br>
  <input id="emailInput" placeholder="Email"><br>
  <input id="passInput" type="password" placeholder="ContraseÃ±a"><br>
  <button onclick="register()">Registrarse</button>
  <button onclick="login()">Entrar</button>
</div>

<div id="gameBox" style="display:none">
  <h2>Amigos</h2>
  <input id="friendInput" placeholder="Nombre amigo">
  <button onclick="addFriend()">AÃ±adir</button>
  <ul id="friends"></ul>
</div>

</body>
</html>

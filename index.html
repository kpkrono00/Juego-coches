<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego de Coches</title>

<style>
html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:Arial, sans-serif;
  background:#111;
  color:white;
}

/* LOGIN */
#loginBox{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#0f0f0f;
  padding:30px;
  border-radius:15px;
  box-shadow:0 0 40px black;
  z-index:1000;
}
#loginBox input{
  width:220px;
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  border:none;
}
#loginBox button{
  padding:10px 18px;
  margin:8px 4px;
  border-radius:6px;
  border:none;
  cursor:pointer;
}

/* JUEGO */
#game{
  display:none;
  width:100vw;
  height:100vh;
  position:relative;
}

/* MAPA */
#map{
  position:absolute;
  inset:0;
  background:
    repeating-linear-gradient(
      45deg,
      #2a2a2a 0px,
      #2a2a2a 40px,
      #333 40px,
      #333 80px
    );
}

/* COCHE */
#car{
  position:absolute;
  width:26px;
  height:48px;
  background:red;
  border:2px solid black;
  border-radius:6px;
  left:50%;
  top:50%;
  transform-origin:50% 50%;
}

/* TURBO UI */
#turboUI{
  position:fixed;
  right:20px;
  top:50%;
  transform:translateY(-50%);
  width:120px;
  height:120px;
}
#turboRing{
  width:100%;
  height:100%;
  border-radius:50%;
  background:conic-gradient(#1e90ff 360deg,#111 360deg);
}
#turboCenter{
  position:absolute;
  inset:25px;
  background:black;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:30px;
  border:2px solid #1e90ff;
}

/* MENÚ */
#menuOverlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.75);
  display:none;
  z-index:900;
  justify-content:center;
  align-items:center;
}
#menuBox{
  background:#0e0e0e;
  padding:30px;
  border-radius:20px;
  width:500px;
}
.menuBtn{
  width:100%;
  padding:14px;
  margin:10px 0;
  font-size:18px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>Login / Registro</h2>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Contraseña"><br>
  <button id="register">Registrarse</button>
  <button id="login">Entrar</button>
</div>

<!-- JUEGO -->
<div id="game">
  <div id="map"></div>
  <div id="car"></div>

  <div id="menuOverlay">
    <div id="menuBox">
      <h2>Menú</h2>
      <button class="menuBtn" id="resumeBtn">Continuar</button>
    </div>
  </div>

  <div id="turboUI">
    <div id="turboRing"></div>
    <div id="turboCenter">⚡</div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyBCutoJF6Rvw3A7ab3waAaMLDgklr5NEDA",
  authDomain: "juego-de-coches-d2613.firebaseapp.com",
  projectId: "juego-de-coches-d2613",
  storageBucket: "juego-de-coches-d2613.appspot.com",
  messagingSenderId: "34324442906",
  appId: "1:34324442906:web:640ef52af5b9a0442806a3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

/* LOGIN */
register.onclick = () =>
  createUserWithEmailAndPassword(auth,email.value,password.value);

login.onclick = () =>
  signInWithEmailAndPassword(auth,email.value,password.value);

onAuthStateChanged(auth,user=>{
  if(user){
    loginBox.style.display="none";
    game.style.display="block";
    startGame();
  }
});

/* JUEGO */
function startGame(){
  const car=document.getElementById("car");
  const turboRing=document.getElementById("turboRing");

  let x=innerWidth/2,y=innerHeight/2;
  let angle=0,speed=0,turbo=100;
  let keys={},paused=false;

  addEventListener("keydown",e=>{
    if(e.key==="Escape"){
      paused=!paused;
      menuOverlay.style.display=paused?"flex":"none";
    }
    keys[e.key]=true;
  });
  addEventListener("keyup",e=>keys[e.key]=false);

  resumeBtn.onclick=()=>{
    paused=false;
    menuOverlay.style.display="none";
  };

  function loop(){
    if(!paused){
      if(keys.w) speed+=0.3;
      if(keys.s) speed-=0.3;
      if(keys.a) angle-=4;
      if(keys.d) angle+=4;

      if(keys[" "] && turbo>0){
        speed+=0.6;
        turbo-=1.2;
      }else if(turbo<100){
        turbo+=0.5;
      }

      speed*=0.96;

      x+=Math.sin(angle*Math.PI/180)*speed;
      y-=Math.cos(angle*Math.PI/180)*speed;

      x=Math.max(20,Math.min(innerWidth-20,x));
      y=Math.max(20,Math.min(innerHeight-20,y));

      car.style.left=x+"px";
      car.style.top=y+"px";
      car.style.transform=`rotate(${angle}deg)`;

      turboRing.style.background=
        `conic-gradient(#1e90ff ${turbo*3.6}deg,#111 ${turbo*3.6}deg)`;
    }
    requestAnimationFrame(loop);
  }
  loop();
}
</script>

</body>
</html>
